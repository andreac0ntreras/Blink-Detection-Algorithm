# Introduction
The purpose of this project is to develop an algorithm for blink detection to be used for the analysis of 
data from eye trackers such as Tobii products.

Data from any eyetracker can be analyzed using the scripts in this repository, however, the algorithm was built 
for Tobii products specifically, so be advised that different brands of eyetrackers have different noise
patterns. 

## Cloning the repository
To run this program, enter the following in your command prompt
```commandline
git clone https://github.com/andreac0ntreras/Blink-Detection-Algorithm.git
```

### Navigate to the codebase
Move into the project directory
```commandline
cd ./EOGData
```

### Install the required packages
```commandline
pip install -r requirements.txt
```

## Sourcing
Within the project directory, there are three directories. The data directory (_data/raw/XDF Files_) contains the raw data from the
OWDM experiment, which we will be analyzing. The raw data is in the form of XDF files, where one of the streams 
contains the eye tracker timeseries data and the eyetracker specs. To extract the relevant eyetracker information from the XDF files
(**timestamps, left_pupil_size, and right_pupil_size**), run the following line of code in the main.py file.
```doctest
sourcing_utils.process_xdf_files(folder_path, output_folder)
```

This line of code uses functions from the sourcing_utils.py file to convert the raw XDF Files to CSV files 
that contain the relevant variables

## Blink Detection and Processing
After generating a CSV file containing the pupil sizes and timestamps for each day and participant, 
we can now implement our blink detection algorithm. By running the following line in the main.py file,
an output CSV file called _compiled_blink_rates.csv_ is generated (in the _output/features_ directory) with the columns 
subject, day ,blink_rate_mean, and percentage_missing_data, which states the blink rate and percentage of relevant missing data from 
each participant for each day. 

```doctest
processing_utils.process_csv_files(output_folder)
```

## Plotting
Finally, using the CSV files generated by 
```doctest
sourcing_utils.process_xdf_files(folder_path, output_folder)
```

we can create graphs that plot time against pupil size for each day for each participant. 
Once you run the following line of code in main.py, one plot for each day for each participant will be generated in
the directory (_output/plots_). In addition to the lines that show the trend of left and right pupil size 
against time, there will be pink and green lines, where the green represents times at which the blink detection algorithm recognized 
a blink onset, and pink represents times at which the blink detection algorithm recognized a blink offset.
```doctest
plotting_utils.plot_all_time_v_pupil_size_csv_files_in_directory(output_folder)
```

## Gallery
Here is an example of a zoomed in plot outcome:
![img.png](img.png)

## Specifications
The hardware used during this experiment is the Tobii Spectrum Pro with a sampling frequency of 600Hz.

